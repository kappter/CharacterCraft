<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CharacterCraft - Enhanced Character Creation Tool</title>
    <link rel="icon" href="../favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Enhanced CharacterCraft Styles with Fixed Header/Footer and Proper Navigation */

        /* CSS Variables for theming */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --background-color: #ffffff;
            --surface-color: #f8f9fa;
            --text-color: #2c3e50;
            --text-muted: #6c757d;
            --border-color: #dee2e6;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 12px rgba(0,0,0,0.15);
            --header-height: 70px;
            --nav-height: 60px;
            --footer-height: 50px;
        }

        /* Dark theme variables */
        [data-theme="dark"] {
            --primary-color: #34495e;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --background-color: #1a1a1a;
            --surface-color: #2d2d2d;
            --text-color: #ffffff;
            --text-muted: #b0b0b0;
            --border-color: #404040;
            --shadow: 0 2px 4px rgba(0,0,0,0.3);
            --shadow-lg: 0 4px 12px rgba(0,0,0,0.4);
        }

        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            padding-top: calc(var(--header-height) + var(--nav-height));
            padding-bottom: var(--footer-height);
            min-height: 100vh;
        }

        /* Fixed Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: url('../cclogo.png') center/contain no-repeat;
            background-color: rgba(255,255,255,0.1);
            border-radius: 8px;
        }

        header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
            flex-grow: 1;
            text-align: center;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .theme-toggle label {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .toggle {
            width: 50px;
            height: 24px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            border: none;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle:checked {
            background: var(--success-color);
        }

        .toggle::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: transform 0.3s ease;
        }

        .toggle:checked::before {
            transform: translateX(26px);
        }

        /* Fixed Navigation */
        nav {
            position: fixed;
            top: var(--header-height);
            left: 0;
            right: 0;
            height: var(--nav-height);
            background: var(--surface-color);
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 0 2rem;
            box-shadow: var(--shadow);
            z-index: 999;
            overflow-x: auto;
        }

        .tab-button {
            background: transparent;
            border: 2px solid transparent;
            color: var(--text-color);
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: fit-content;
        }

        .tab-button:hover {
            background: var(--secondary-color);
            color: white;
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .reset-app {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            margin-left: auto;
        }

        .reset-app:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        /* Main Content Area */
        main {
            flex: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .container {
            background: var(--surface-color);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow);
            min-height: calc(100vh - var(--header-height) - var(--nav-height) - var(--footer-height) - 4rem);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: var(--secondary-color);
            border-radius: 2px;
        }

        /* Form Styles */
        .character-form {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        .input-group {
            display: flex;
            gap: 0.5rem;
            align-items: stretch;
        }

        input, select, textarea {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--background-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        /* Button Styles */
        button {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        button:hover:not(:disabled) {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        button:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: var(--primary-color);
        }

        .btn-primary:hover:not(:disabled) {
            background: #1a252f;
        }

        .btn-success {
            background: var(--success-color);
        }

        .btn-success:hover:not(:disabled) {
            background: #219a52;
        }

        .btn-warning {
            background: var(--warning-color);
        }

        .btn-warning:hover:not(:disabled) {
            background: #d68910;
        }

        .btn-danger {
            background: var(--accent-color);
        }

        .btn-danger:hover:not(:disabled) {
            background: #c0392b;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin: 2rem 0;
        }

        /* Bio Output Styles */
        .bio-output {
            background: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
            min-height: 200px;
            font-size: 1.05rem;
            line-height: 1.7;
            box-shadow: var(--shadow);
        }

        .bio-output h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .bio-output p {
            margin-bottom: 1rem;
        }

        .bio-output.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-style: italic;
            background: var(--surface-color);
        }

        /* Fixed Footer */
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--footer-height);
            background: var(--surface-color);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            color: var(--text-muted);
            z-index: 998;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            :root {
                --header-height: 60px;
                --nav-height: 50px;
            }
            
            header {
                padding: 0 1rem;
            }
            
            header h1 {
                font-size: 1.4rem;
            }
            
            nav {
                padding: 0 1rem;
                gap: 0.5rem;
            }
            
            .tab-button {
                padding: 0.4rem 1rem;
                font-size: 0.8rem;
            }
            
            main {
                padding: 1rem;
            }
            
            .container {
                padding: 1.5rem;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }
        }

        @media (max-width: 480px) {
            .theme-toggle {
                display: none;
            }
            
            header h1 {
                font-size: 1.2rem;
            }
            
            .tab-button {
                padding: 0.3rem 0.8rem;
                font-size: 0.75rem;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .hidden { display: none; }
        .visible { display: block; }
    </style>
</head>
<body data-theme="light">
    <!-- Fixed Header -->
    <header>
        <div class="logo"></div>
        <h1>CharacterCraft</h1>
        <div class="theme-toggle">
            <label for="theme-toggle">Dark Mode</label>
            <input type="checkbox" id="theme-toggle" class="toggle">
        </div>
    </header>

    <!-- Fixed Navigation -->
    <nav>
        <button class="tab-button active" data-tab="create">Create Character</button>
        <button class="tab-button" data-tab="compare">Compare Characters</button>
        <button class="tab-button" data-tab="saved">Saved Characters</button>
        <button class="reset-app">Reset App</button>
    </nav>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Create Character Tab -->
            <div id="create-tab" class="tab-content active">
                <h2 class="section-title">Create Character</h2>
                
                <div class="character-form">
                    <div class="form-group">
                        <label for="name" class="form-label">Character Name</label>
                        <div class="input-group">
                            <input type="text" id="name" placeholder="Enter character name">
                            <button class="randomize-name btn-warning">Random</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="age" class="form-label">Age</label>
                        <div class="input-group">
                            <input type="number" id="age" min="1" max="120" placeholder="Enter age">
                            <button class="randomize-age btn-warning">Random</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="gender" class="form-label">Gender</label>
                        <div class="input-group">
                            <select id="gender">
                                <option value="">Select gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Non-binary">Non-binary</option>
                                <option value="Other">Other</option>
                            </select>
                            <button class="randomize-gender btn-warning">Random</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="locale" class="form-label">Location/Origin</label>
                        <div class="input-group">
                            <input type="text" id="locale" placeholder="Enter location or origin">
                            <button class="randomize-locale btn-warning">Random</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="occupation" class="form-label">Occupation</label>
                        <div class="input-group">
                            <input type="text" id="occupation" placeholder="Enter occupation">
                            <button class="randomize-occupation btn-warning">Random</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="traits" class="form-label">Character Traits</label>
                        <div class="input-group">
                            <textarea id="traits" placeholder="Enter character traits (comma-separated)"></textarea>
                            <button class="randomize-traits btn-warning">Random</button>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="randomize-everything btn-primary">Randomize All</button>
                    <button class="generate-bio btn-success">Generate Bio</button>
                    <button class="generate-autobiography btn-success">Generate Autobiography</button>
                    <button class="save-character btn-primary">Save Character</button>
                </div>

                <!-- Bio Output -->
                <div class="bio-output" id="shortBioOutput">
                    <div class="empty">External biography will appear here...</div>
                </div>

                <!-- Autobiography Output -->
                <div class="bio-output" id="autobiographyOutput">
                    <div class="empty">Autobiography will appear here...</div>
                </div>

                <div class="action-buttons">
                    <button class="export-bio btn-secondary" disabled>Export Bio</button>
                    <button class="export-autobiography btn-secondary" disabled>Export Autobiography</button>
                    <button class="export-full-report btn-secondary" disabled>Export Full Report</button>
                </div>
            </div>

            <!-- Compare Characters Tab -->
            <div id="compare-tab" class="tab-content">
                <h2 class="section-title">Compare Characters</h2>
                
                <div class="form-group">
                    <label for="character1" class="form-label">First Character</label>
                    <select id="character1">
                        <option value="">Select first character</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="character2" class="form-label">Second Character</label>
                    <select id="character2">
                        <option value="">Select second character</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="context" class="form-label">Scenario Context (Optional)</label>
                    <input type="text" id="context" placeholder="e.g., 'trapped in an elevator', 'working on a project together'">
                </div>
                
                <div class="action-buttons">
                    <button class="compare-characters btn-primary">Generate Comparison</button>
                    <button class="randomize-comparison btn-warning">Random Scenario</button>
                </div>
                
                <div class="bio-output" id="comparisonOutput">
                    <div class="empty">Character comparison and writing prompts will appear here...</div>
                </div>
                
                <div class="action-buttons">
                    <button class="export-comparison btn-secondary" disabled>Export Comparison Report</button>
                </div>
            </div>

            <!-- Saved Characters Tab -->
            <div id="saved-tab" class="tab-content">
                <h2 class="section-title">Saved Characters</h2>
                
                <div id="characterList" class="character-list">
                    <div class="empty">No saved characters yet. Create and save a character to see it here.</div>
                </div>
                
                <div class="action-buttons">
                    <button class="export-all-characters btn-secondary">Export All Characters</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Fixed Footer -->
    <footer>
        <p>&copy; 2025 CharacterCraft - Enhanced Character Creation Tool</p>
    </footer>

    <script>
        // Enhanced CharacterCraft - Self-contained version for test directory
        class CharacterCraft {
            constructor() {
                this.characters = JSON.parse(localStorage.getItem('characters')) || [];
                this.currentCharacter = null;
                this.init();
            }

            init() {
                this.initializeEventListeners();
                this.initializeTheme();
                this.updateCharacterSelects();
                this.displaySavedCharacters();
                console.log('CharacterCraft initialized');
            }

            initializeEventListeners() {
                // Tab switching
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const tabId = e.target.dataset.tab;
                        this.switchTab(tabId);
                    });
                });

                // Theme toggle
                const themeToggle = document.getElementById('theme-toggle');
                if (themeToggle) {
                    themeToggle.addEventListener('change', () => this.toggleTheme());
                }

                // Character creation
                document.querySelector('.randomize-everything')?.addEventListener('click', () => this.randomizeAll());
                document.querySelector('.generate-bio')?.addEventListener('click', () => this.generateBio());
                document.querySelector('.generate-autobiography')?.addEventListener('click', () => this.generateAutobiography());
                document.querySelector('.save-character')?.addEventListener('click', () => this.saveCharacter());

                // Individual randomization buttons
                document.querySelector('.randomize-name')?.addEventListener('click', () => this.randomizeName());
                document.querySelector('.randomize-age')?.addEventListener('click', () => this.randomizeAge());
                document.querySelector('.randomize-gender')?.addEventListener('click', () => this.randomizeGender());
                document.querySelector('.randomize-locale')?.addEventListener('click', () => this.randomizeLocale());
                document.querySelector('.randomize-occupation')?.addEventListener('click', () => this.randomizeOccupation());
                document.querySelector('.randomize-traits')?.addEventListener('click', () => this.randomizeTraits());

                // Export buttons
                document.querySelector('.export-bio')?.addEventListener('click', () => this.exportBio());
                document.querySelector('.export-autobiography')?.addEventListener('click', () => this.exportAutobiography());
                document.querySelector('.export-full-report')?.addEventListener('click', () => this.exportFullReport());

                // Character comparison
                document.querySelector('.compare-characters')?.addEventListener('click', () => this.compareCharacters());
                document.querySelector('.export-comparison')?.addEventListener('click', () => this.exportComparison());

                // Reset app
                document.querySelector('.reset-app')?.addEventListener('click', () => this.resetApp());
            }

            initializeTheme() {
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.body.setAttribute('data-theme', savedTheme);
                const themeToggle = document.getElementById('theme-toggle');
                if (themeToggle) {
                    themeToggle.checked = savedTheme === 'dark';
                }
            }

            toggleTheme() {
                const currentTheme = document.body.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                document.body.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            }

            switchTab(tabId) {
                // Update tab buttons
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabId}"]`)?.classList.add('active');

                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabId}-tab`)?.classList.add('active');

                // Refresh data for specific tabs
                if (tabId === 'saved') {
                    this.displaySavedCharacters();
                } else if (tabId === 'compare') {
                    this.updateCharacterSelects();
                }
            }

            // Character Creation Methods
            randomizeAll() {
                this.randomizeName();
                this.randomizeAge();
                this.randomizeGender();
                this.randomizeLocale();
                this.randomizeOccupation();
                this.randomizeTraits();
            }

            randomizeName() {
                const names = ['Elena Rodriguez', 'Marcus Chen', 'Aria Patel', 'Kai Thompson', 'Luna Nakamura', 'Diego Santos', 'Zara Ahmed', 'Felix Kowalski', 'Maya Singh', 'River Johnson'];
                const randomName = names[Math.floor(Math.random() * names.length)];
                document.getElementById('name').value = randomName;
            }

            randomizeAge() {
                const age = Math.floor(Math.random() * 60) + 18; // 18-77
                document.getElementById('age').value = age;
            }

            randomizeGender() {
                const genders = ['Male', 'Female', 'Non-binary', 'Other'];
                const randomGender = genders[Math.floor(Math.random() * genders.length)];
                document.getElementById('gender').value = randomGender;
            }

            randomizeLocale() {
                const locales = ['Barcelona, Spain', 'Tokyo, Japan', 'New York, USA', 'London, UK', 'Sydney, Australia', 'Toronto, Canada', 'Berlin, Germany', 'Mumbai, India', 'SÃ£o Paulo, Brazil', 'Cairo, Egypt'];
                const randomLocale = locales[Math.floor(Math.random() * locales.length)];
                document.getElementById('locale').value = randomLocale;
            }

            randomizeOccupation() {
                const occupations = ['Software Engineer', 'Graphic Designer', 'Teacher', 'Chef', 'Journalist', 'Architect', 'Musician', 'Therapist', 'Photographer', 'Marine Biologist'];
                const randomOccupation = occupations[Math.floor(Math.random() * occupations.length)];
                document.getElementById('occupation').value = randomOccupation;
            }

            randomizeTraits() {
                const traits = ['Creative', 'Analytical', 'Empathetic', 'Ambitious', 'Calm', 'Adventurous', 'Organized', 'Spontaneous', 'Introverted', 'Extroverted', 'Patient', 'Energetic'];
                const selectedTraits = [];
                const numTraits = Math.floor(Math.random() * 3) + 2; // 2-4 traits
                
                for (let i = 0; i < numTraits; i++) {
                    const availableTraits = traits.filter(trait => !selectedTraits.includes(trait));
                    if (availableTraits.length > 0) {
                        const randomTrait = availableTraits[Math.floor(Math.random() * availableTraits.length)];
                        selectedTraits.push(randomTrait);
                    }
                }
                
                document.getElementById('traits').value = selectedTraits.join(', ');
            }

            generateBio() {
                const character = this.getCharacterFromForm();
                if (!character.name) {
                    alert('Please enter a character name first.');
                    return;
                }

                const bio = this.generateDetailedBio(character);
                document.getElementById('shortBioOutput').innerHTML = bio;
                
                // Enable export buttons
                document.querySelector('.export-bio').disabled = false;
                document.querySelector('.export-full-report').disabled = false;
            }

            generateAutobiography() {
                const character = this.getCharacterFromForm();
                if (!character.name) {
                    alert('Please enter a character name first.');
                    return;
                }

                const autobiography = this.generateDetailedAutobiography(character);
                document.getElementById('autobiographyOutput').innerHTML = autobiography;
                
                // Enable export buttons
                document.querySelector('.export-autobiography').disabled = false;
                document.querySelector('.export-full-report').disabled = false;
            }

            generateDetailedBio(character) {
                const age = character.age;
                const traits = character.traits.split(',').map(t => t.trim()).filter(t => t);
                
                return `
                    <h3>Character Biography</h3>
                    <p><strong>${character.name}</strong>, a ${age}-year-old ${character.gender} ${character.occupation} from ${character.locale}, is known for their distinctive personality traits including ${traits.slice(0, 3).join(', ')}.</p>
                    <p>Their professional life as a ${character.occupation} has shaped their worldview, while their background in ${character.locale} has given them a unique perspective on life. These experiences have contributed to their complex personality and approach to relationships and challenges.</p>
                    <p>Those who know ${character.name} would describe them as someone who embodies the qualities of ${traits.slice(0, 2).join(' and ')}, making them both memorable and influential in their personal and professional circles.</p>
                `;
            }

            generateDetailedAutobiography(character) {
                const age = character.age;
                const traits = character.traits.split(',').map(t => t.trim()).filter(t => t);
                
                let ageStyle = '';
                if (age < 25) {
                    ageStyle = "I'm still figuring out who I'm supposed to be. Some days I feel like I have it all together, other days I feel like I'm pretending to be an adult.";
                } else if (age < 40) {
                    ageStyle = "I'm learning to accept that I'm not the person I thought I'd be at this age, and that's okay. Life has a way of surprising you.";
                } else if (age < 60) {
                    ageStyle = "Looking back, I can see the threads that connect all the different versions of myself. The experiences that shaped me, the choices that defined me.";
                } else {
                    ageStyle = "At this stage of life, I'm more interested in authenticity than approval. I've learned that the opinions that matter most come from people who truly know me.";
                }

                return `
                    <h3>Autobiography</h3>
                    <div style="font-family: Georgia, serif; line-height: 1.8;">
                        <p style="text-indent: 2rem;">My name is ${character.name}, and if you met me, you'd probably see a ${age}-year-old ${character.occupation} from ${character.locale}. But that's just the surface, the version of me that fits neatly into conversations and forms. The real story is messier, more complicated, and infinitely more human.</p>
                        
                        <p style="text-indent: 2rem;">Growing up in ${character.locale}, I learned early that the world was bigger and more complex than our little corner of it. My childhood was filled with moments that seemed ordinary then but feel significant now - the smell of morning coffee, the sound of familiar voices, the weight of expectations I didn't yet understand.</p>
                        
                        <p style="text-indent: 2rem;">People often describe me as ${traits.slice(0, 2).join(' and ')}, and I suppose that's accurate enough. But what they don't see is how those traits developed - through struggles with self-doubt, through relationships that taught me about vulnerability, through quiet moments when I questioned everything I thought I knew about myself.</p>
                        
                        <p style="text-indent: 2rem;">My work as a ${character.occupation} is both exactly what I expected and nothing like I imagined. The day-to-day reality is different from the dreams, but there's something satisfying about building a life that's recognizably mine, even if it's not perfect.</p>
                        
                        <p style="text-indent: 2rem; font-style: italic; border-left: 4px solid var(--secondary-color); padding-left: 1.5rem; margin-top: 2rem;">${ageStyle} Maybe that's what growing up really means - not having all the answers, but being comfortable with the questions.</p>
                    </div>
                `;
            }

            saveCharacter() {
                const character = this.getCharacterFromForm();
                if (!character.name) {
                    alert('Please enter a character name first.');
                    return;
                }

                // Get generated content
                const bioElement = document.getElementById('shortBioOutput');
                const autobiographyElement = document.getElementById('autobiographyOutput');
                
                if (bioElement && !bioElement.querySelector('.empty')) {
                    character.bio = bioElement.innerHTML;
                }
                
                if (autobiographyElement && !autobiographyElement.querySelector('.empty')) {
                    character.autobiography = autobiographyElement.innerHTML;
                }

                character.id = Date.now().toString();
                character.createdAt = new Date().toISOString();

                this.characters.push(character);
                localStorage.setItem('characters', JSON.stringify(this.characters));

                this.updateCharacterSelects();
                this.displaySavedCharacters();
                
                alert(`Character "${character.name}" saved successfully!`);
            }

            getCharacterFromForm() {
                return {
                    name: document.getElementById('name')?.value || '',
                    age: parseInt(document.getElementById('age')?.value) || 25,
                    gender: document.getElementById('gender')?.value || '',
                    locale: document.getElementById('locale')?.value || '',
                    occupation: document.getElementById('occupation')?.value || '',
                    traits: document.getElementById('traits')?.value || ''
                };
            }

            compareCharacters() {
                const char1Id = document.getElementById('character1')?.value;
                const char2Id = document.getElementById('character2')?.value;
                const context = document.getElementById('context')?.value || '';

                if (!char1Id || !char2Id) {
                    alert('Please select two characters to compare.');
                    return;
                }

                if (char1Id === char2Id) {
                    alert('Please select two different characters.');
                    return;
                }

                const char1 = this.characters.find(c => c.id === char1Id);
                const char2 = this.characters.find(c => c.id === char2Id);

                const comparison = this.generateComparison(char1, char2, context);
                document.getElementById('comparisonOutput').innerHTML = comparison;
                document.querySelector('.export-comparison').disabled = false;
            }

            generateComparison(char1, char2, context) {
                const contextText = context ? ` in the context of "${context}"` : '';
                
                return `
                    <h3>Character Comparison</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 1rem 0;">
                        <div>
                            <h4>${char1.name}</h4>
                            <p>${char1.age} years old, ${char1.gender}<br>
                            ${char1.occupation} from ${char1.locale}<br>
                            Traits: ${char1.traits}</p>
                        </div>
                        <div>
                            <h4>${char2.name}</h4>
                            <p>${char2.age} years old, ${char2.gender}<br>
                            ${char2.occupation} from ${char2.locale}<br>
                            Traits: ${char2.traits}</p>
                        </div>
                    </div>
                    
                    <h4>Writing Prompt</h4>
                    <div style="background: var(--surface-color); padding: 1.5rem; border-left: 4px solid var(--secondary-color); margin: 1rem 0;">
                        <p><strong>Scenario:</strong> ${char1.name} and ${char2.name} find themselves${contextText}. Their different backgrounds (${char1.locale} vs ${char2.locale}) and contrasting personalities create an interesting dynamic.</p>
                        <p><strong>Potential Conflict:</strong> ${char1.name}'s ${char1.traits.split(',')[0]?.trim()} nature might clash with ${char2.name}'s ${char2.traits.split(',')[0]?.trim()} approach to the situation.</p>
                        <p><strong>Character Growth:</strong> Through their interaction, both characters could learn from each other's perspectives and find common ground despite their differences.</p>
                    </div>
                `;
            }

            updateCharacterSelects() {
                const selects = ['character1', 'character2'];
                
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        const currentValue = select.value;
                        select.innerHTML = '<option value="">Select a character</option>';
                        
                        this.characters.forEach(char => {
                            const option = document.createElement('option');
                            option.value = char.id;
                            option.textContent = char.name;
                            select.appendChild(option);
                        });
                        
                        select.value = currentValue;
                    }
                });
            }

            displaySavedCharacters() {
                const container = document.getElementById('characterList');
                if (!container) return;

                if (this.characters.length === 0) {
                    container.innerHTML = '<div class="empty">No saved characters yet. Create and save a character to see it here.</div>';
                    return;
                }

                container.innerHTML = this.characters.map(char => `
                    <div style="background: var(--background-color); border: 2px solid var(--border-color); border-radius: 12px; padding: 1.5rem; margin: 1rem 0; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; font-size: 1.1rem; color: var(--primary-color); margin-bottom: 0.5rem;">${char.name}</div>
                            <div style="color: var(--text-muted); font-size: 0.9rem;">
                                ${char.age} years old, ${char.gender} ${char.occupation} from ${char.locale}
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn-danger" onclick="app.deleteCharacter('${char.id}')">Delete</button>
                        </div>
                    </div>
                `).join('');
            }

            deleteCharacter(characterId) {
                const character = this.characters.find(c => c.id === characterId);
                if (!character) return;

                if (confirm(`Are you sure you want to delete "${character.name}"?`)) {
                    this.characters = this.characters.filter(c => c.id !== characterId);
                    localStorage.setItem('characters', JSON.stringify(this.characters));
                    this.displaySavedCharacters();
                    this.updateCharacterSelects();
                }
            }

            // Export Methods
            exportBio() {
                const bioContent = document.getElementById('shortBioOutput').innerHTML;
                if (bioContent.includes('empty')) {
                    alert('Please generate a bio first.');
                    return;
                }
                this.downloadFile('character_bio.html', bioContent, 'text/html');
            }

            exportAutobiography() {
                const autobiographyContent = document.getElementById('autobiographyOutput').innerHTML;
                if (autobiographyContent.includes('empty')) {
                    alert('Please generate an autobiography first.');
                    return;
                }
                this.downloadFile('character_autobiography.html', autobiographyContent, 'text/html');
            }

            exportFullReport() {
                const character = this.getCharacterFromForm();
                const bioContent = document.getElementById('shortBioOutput').innerHTML;
                const autobiographyContent = document.getElementById('autobiographyOutput').innerHTML;
                
                const fullReport = `
<!DOCTYPE html>
<html>
<head>
    <title>Character Report: ${character.name}</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { margin-bottom: 30px; }
        h1, h2 { color: #2c3e50; }
    </style>
</head>
<body>
    <h1>Character Report: ${character.name}</h1>
    <div class="section">
        <h2>Basic Information</h2>
        <p><strong>Name:</strong> ${character.name}</p>
        <p><strong>Age:</strong> ${character.age}</p>
        <p><strong>Gender:</strong> ${character.gender}</p>
        <p><strong>Location:</strong> ${character.locale}</p>
        <p><strong>Occupation:</strong> ${character.occupation}</p>
        <p><strong>Traits:</strong> ${character.traits}</p>
    </div>
    <div class="section">
        <h2>External Biography</h2>
        ${bioContent}
    </div>
    <div class="section">
        <h2>Autobiography</h2>
        ${autobiographyContent}
    </div>
</body>
</html>`;
                
                this.downloadFile('character_full_report.html', fullReport, 'text/html');
            }

            exportComparison() {
                const comparisonContent = document.getElementById('comparisonOutput').innerHTML;
                if (comparisonContent.includes('empty')) {
                    alert('Please generate a comparison first.');
                    return;
                }
                this.downloadFile('character_comparison.html', comparisonContent, 'text/html');
            }

            downloadFile(filename, content, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            resetApp() {
                if (confirm('Are you sure you want to reset the app? This will clear all data.')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        // Initialize the app when DOM is loaded
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new CharacterCraft();
        });
    </script>
</body>
</html>

